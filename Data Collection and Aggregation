2.1 How will you gather disk usage data from all VMs?

We can use Systems Manager to install Cloudwatch Agents to gather disk usage data from all VMs/EC2.

* Create an IAM Role for the Instances with policies : CloudWatchAgentServerPolicy and 	AmazonSSMManagedInstanceCore

* Attach the IAM role to EC2 instance

* Install the Cloudwatch Agent using SSM : 
a) Go to the AWS Systems Manager console and select Run Command. 
b) In the Command document section, select AWS-ConfigureAWSPackage 
c) In the Command parameters, input AmazonCloudWatchAgent in the Name field. 
d) In the Targets section, choose the instances you want to install the agent on, you can manually select instances or specify instance tags to target a group of instances. 
In our scenario, we will use the tagging mechanism to ensure all EC2 instances with specific tags have Cloudwatch Agents installed and using Config to create alerts if instance is created without tag and remediating it on the fly.

* Create a CloudWatch Agent Configuration in Parameter Store a) In the SSM Console, navigate to Parameter Store and click Create parameter. b) Name your parameter e.g., AmazonCloudWatch-Config. c) In the Value field, paste your CloudWatch Agent configuration file in JSON format. d) Linux CloudWatch Agent Configuration: (This sample configuration collects disk usage (used_percent) and memory usage (mem_used_percent) metrics from Linux instances and pushes them to CloudWatch every 60 seconds.)
{
    "metrics": {
        "aggregation_dimensions": [
            [
                "InstanceId"
            ]
        ],
        "metrics_collected": {
            "disk": {
                "measurement": [
                    "used_percent"
                ],
                "metrics_collection_interval": 60,
                "resources": [
                    "*"
                ]
            },
            "mem": {
                "measurement": [
                    "mem_used_percent"
                ],
                "metrics_collection_interval": 60
            }
        },
        "append_dimensions": {
            "InstanceId": "${aws:InstanceId}"
        }
    }
}


* Start the CloudWatch Agent 
a) Execute Run Command in the SSM Console. 
b) In the Command document section, choose AmazonCloudWatch-ManageAgent. 
c) In the Command parameters section, specify the Optional Configuration Location (e.g., AmazonCloudWatch-Config). 
d) Select the target instances. 
e) Click Run.

* After the command runs successfully, you should see the metrics appear in the CloudWatch CWAgent namespace.


2.2 How will you centralize and present this data for easy monitoring?
* Create a CloudWatch Dashboard: 
a) Navigate to the Amazon CloudWatch console. 
b) Create a new dashboard or open an existing one. 
c) Add a widget to the dashboard. 


* Set Up CloudWatch Alarms: 
a) From the CloudWatch console, navigate to Alarms. 
b) Create a new alarm. 
c) Select the same disk utilization metric you used for the dashboard. 
d) Define the threshold for the alarm (e.g., trigger when disk free space falls below a certain percentage or disk used percentage exceeds a threshold). 
e) Configure the notification action for the alarm, such as sending a notification to an Amazon SNS topic, which can then deliver alerts via email, SMS, or other integrated services. 

